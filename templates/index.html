<!DOCTYPE html>
<html lang="en">

<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="">
  <meta name="author" content="">

  <title>yt:Spherical Volume Rendering</title>

  <!-- Bootstrap core CSS -->
{% block head %}

        <link rel="stylesheet" href="{{url_for('static', filename='css/clean-blog.min.css')}}">

<link rel="stylesheet" href="{{url_for('.static', filename='../static/vendor/bootstrap/css/bootstrap.min.css')}}">
<script src="https://d3js.org/d3.v3.min.js"></script>

    <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>

  <!-- Custom fonts for this template -->
<link rel="stylesheet" href="{{url_for('.static', filename='../static/vendor/fontawesome-free/css/all.min.css')}}">

  <link href='https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
  <link href='https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>

  <!-- Custom styles for this template -->

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">

    <script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>


<script type="text/javascript" src="https://canvasjs.com/assets/script/canvasjs.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.1.0.min.js"   integrity="sha256-cCueBR6CsyA4/9szpPfrX3s49M9vUU5BgtiJj06wt/s="   crossorigin="anonymous"></script><script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.0.3/js/bootstrap.min.js" integrity="sha384-s1ITto93iSMDxlp/79qhWHi+LsIi9Gx6yL+cOKDuymvihkfol83TYbLbOw+W/wv4" crossorigin="anonymous"></script>
    {% endblock %}


    <style>

svg {
  font: 10px sans-serif;
  cursor: crosshair;
  background: #fff;
  width:100%;

}



.axis path,
  .axis line{
    fill: none;
    stroke: #777;
  }

  .rline{
    fill: none;
    stroke: rgb(255,74,27);
    stroke-width: 2px;
  }
.gline{
    fill: none;
    stroke:rgb(40,124,15);
    stroke-dasharray: 2;
    stroke-width: 2px;
  }
.bline{
    fill: none;
    stroke:rgb(0,57,213);
    stroke-dasharray: 10;
    stroke-width: 2px;
  }
  .tick text{
    font-size: 12px;
  }

  .tick line{
    opacity: 0.2;
  }


</style>
</head>

<body>
 <!-- Navigation -->
  <nav class="navbar navbar-expand-lg navbar-dark fixed-top" id="mainNav">
    <div class="container">
      <a class="navbar-brand" href="index.html">Yt Interface</a>
      <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
        Menu
        <i class="fas fa-bars"></i>
      </button>
      <div class="collapse navbar-collapse" id="navbarResponsive">
        <ul class="navbar-nav ml-auto" >


        </ul>

      </div>
    </div>
  </nav>


  <!-- Page Header -->
  <header class="masthead" style="background-image: url('../static/img/yt_logo.png');height:710px">
    <div class="overlay"></div>
    <div class="container">
      <div class="row">
        <div class="col-lg-8 col-md-10 mx-auto">
          <div class="site-heading">
            <h1>Spherical Volume Rendering Interface</h1>
            <span class="subheading">A web interface for data exploration and visualization of physical data that comes from non-cartesian grids</span>
          </div>
        </div>
      </div>
    </div>
  </header>

  <!-- Main Content -->
  <div class="container">
    <div class="row">


      <div class="col-lg-8 col-md-10 mx-auto">
         <h2 class="post-title" id="draw">
              Start drawing
          </h2>
          <h4>Choose your color channel, then click and hold to draw lines on the plotarea</h4>
          <br>
         <div class="btn-group btn-group-justified">
  <div class="btn-group">
          <button type="button" id="redButton" onclick="show('red')" class="btn btn-outline-danger active" style="text-decoration-line: underline;">Red Channel</button>
  </div>
  <div class="btn-group">
          <button type="button" id="greenButton" onclick="show('green')" class="btn btn-outline-success" style="text-decoration-line: underline;text-decoration-style: dotted;">Green Channel</button>
  </div>
  <div class="btn-group">
              <button type="button" id="blueButton" onclick="show('blue')" class="btn btn-outline-primary" style="text-decoration-line: underline;text-decoration-style: dashed;" >Blue Channel</button></div>
  </div>
</div>


              <div class="col-lg-12 col-md-12 mx-auto" style="height: 500px">

        <div class="post-preview" style="height:500px">


            <div id="sketch_2" ></div>



        </div>
      </div>
                    <div class="col-lg-12 mx-auto" >

                        <button class="btn btn-default  float-right" onclick="submit()">Submit</button>

                   <button class="btn btn-default float-right " id="clear">Clear</button>
      </div>
    </div></div>

    <!-- Footer -->

    <div class="container" id="result" style="display: none; height: 500px">
         <hr>
      <div class="row">
        <div class="col-lg-8 col-md-10 mx-auto">
            <h2 class="post-title">
             Color Transfer Function Results
            </h2></div>
          <div class="col-lg-12 col-md-12 mx-auto" style="height: 500px">

        <img class="img-fluid" src="../static/img/result.png" style="height: 400px; width: 100%;">
        </div>
      </div>
    </div>


  <!-- Bootstrap core JavaScript -->
    <script rel="text/javascript" href="{{url_for('.static', filename='../static/vendor/jquery/jquery.min.js')}}"></script>
<script rel="text/javascript" href="{{url_for('.static', filename='../static/vendor/bootstrap/js/bootstrap.bundle.min.js')}}"></script>


  <!-- Custom scripts for this template -->
<script type="text/javascript" src="{{url_for('.static', filename='../static/js/script.js')}}"></script>
<script>

var margin = {top: 20, right: 50, bottom: 20, left: 20};
	width = 1160 - margin.left - margin.right,
	height = 500 - margin.top - margin.bottom;

//variable delcartion

var reddata = [];
var greendata = [];
var bluedata = [];
var session = [];
var redpath;
var greenpath;
var bluepath;
var drawing = false;

var redArray = []
var greenArray =[]
var blueArray = []
var color = "red"


var line = d3.svg.line()
    .interpolate("bundle") // basis, see http://bl.ocks.org/mbostock/4342190
    .tension(1)
    .x(function(d, i) { return d.x; })
    .y(function(d, i) { return d.y; });

var svg = d3.select("#sketch_2").append("svg")
    .attr("width", width + margin.left + margin.right)
    .attr("height", height + margin.top + margin.bottom)

svg.append("g")
    .attr("transform", "translate(" + margin.left + "," + margin.top + ")");



svg
  .on("mousedown", listen)
  .on("touchstart", listen)
  .on("touchend", ignore)
  .on("touchleave", ignore)
  .on("mouseup", ignore)
  .on("mouseleave", ignore);


// ignore default touch behavior
var touchEvents = ['touchstart', 'touchmove', 'touchend'];
touchEvents.forEach(function (eventName) {
  document.body.addEventListener(eventName, function(e){
    e.preventDefault();
  });
});



      // We're passing in a function in d3.max to tell it what we're maxing (x value)
      var x = d3.scale.linear()
          .domain([0, 256])
          .range([margin.left, width - margin.right]);  // Set margins for x specific

      // We're passing in a function in d3.max to tell it what we're maxing (y value)
      var y = d3.scale.linear()
          .domain([0, 1])
          .range([ height - margin.bottom,margin.top]);  // Set margins for y specific

var xAxis = d3.svg.axis()
	.scale(x)
	.orient("bottom")
	.ticks(20);

	var yAxis = d3.svg.axis()
	.scale(y)
	.orient("left")
	.ticks(15)
    .innerTickSize(-width+70)
    .outerTickSize(0)
    .tickPadding(10);

    svg.append("g")
    .attr("class", "axis") // class to style
    	.attr("transform", "translate(" + 10 + "," + (height-20) + ")")
	.call(xAxis);

	svg.append("g")
    .attr("class", "axis")
	.attr("transform", "translate(" + 30 + ",0)")
	.call(yAxis);






function listen () {
  drawing = true;
  output.text('event: ' + d3.event.type);
  reddata = []; // reset point data
  greendata=[];
  bluedata=[];
  redpath = svg.append("path") // start a new line
    .data([reddata])
    .attr("class", "rline")
    .attr("d", line);

  greenpath = svg.append("path") // start a new line
    .data([greendata])
    .attr("class", "gline")
    .attr("d", line);

   bluepath = svg.append("path") // start a new line
    .data([bluedata])
    .attr("class", "bline")
    .attr("d", line);
  if (d3.event.type === 'mousedown') {
    svg.on("mousemove", onmove);
  } else {
    svg.on("touchmove", onmove);
  }
}

function ignore () {
  var before, after;
  output.text('event: ' + d3.event.type);
  svg.on("mousemove", null);
  svg.on("touchmove", null);

  // skip out if we're not drawing
  if (!drawing) return;
  drawing = false;

}


function onmove (e) {
  var type = d3.event.type;
  var point;

  if (type === 'mousemove') {
    point = d3.mouse(this);
  } else {
    // only deal with a single touch input
    point = d3.touches(this)[0];
  }

  // push a new data point onto the back
    xmouse = Math.round(x.invert(point[0] ))
    ymouse = y.invert(point[1])
    //so they don't draw outside the canvas
    if( xmouse<256 && ymouse >=0 && x.invert(point[0]) >=0){

    console.log({x: Math.round( x.invert(point[0])),  // Takes the pixel number to convert to number
            y:  y.invert(point[1])})
   str = {x: Math.round( x.invert(point[0])),  y:  y.invert(point[1])}
    if(color== 'red'){
        redArray.push(str)
        reddata.push({ x: point[0], y: point[1] });
        tick(redpath);
        }
    else
        if(color== 'green'){
        greenArray.push(str)
        greendata.push({ x: point[0], y: point[1] });
        tick(greenpath);
       }
     if(color== 'blue'){
        blueArray.push(str)
        bluedata.push({ x: point[0], y: point[1] });
        tick(bluepath);
        }

    }
}

function tick(path) {
  path.attr("d", function(d) { return line(d); }) // Redraw the path:
}


//end of D3

document.getElementById("clear").addEventListener("click", function(){

       if(color == 'red'){
       redArray = []
       //redpath.attr("d", [] )
       svg.selectAll("path.rline").remove();

	   }
    else
     if(color == 'green'){
       greenArray = []
       //greenpath.attr("d", [] )
       svg.selectAll("path.gline").remove();

       }
    else
     if(color == 'blue'){
       blueArray = []
       //bluepath.attr("d", [] )
       svg.selectAll("path.bline").remove();

	   }

    });


function submit(){
    redValues= new Array(256).fill(0);
    greenValues= new Array(256).fill(0);
    blueValues= new Array(256).fill(0);

    console.log(redArray)
    console.log(greenArray)
    console.log(blueArray)
    if(redArray.length == 0)
    {
     swal({
  icon: 'error',
  title: 'Oops...',
  text: "Please draw the red channel",

})}
    else
        if( greenArray.length == 0  )
    {
     swal({
  icon: 'error',
  title: 'Oops...',
  text: "Please draw the green channel",

})}
      else
        if( blueArray.length == 0  )
    {
     swal({
  icon: 'error',
  title: 'Oops...',
  text: "Please draw the blue channel",

})}
    else
    {
    for (ind = 0 ; ind < redArray.length; ind++)
        {
        index = redArray[ind]['x']
        value = redArray[ind]['y']
        redValues[index]= value;}
    for (ind = 0 ; ind < greenArray.length; ind++)
        {
        index = greenArray[ind]['x']
        value = greenArray[ind]['y']
        greenValues[index]= value;}
    for (ind = 0 ; ind < blueArray.length; ind++) {

        index = blueArray[ind]['x']
        value = blueArray[ind]['y']
        blueValues[index]= value;
        }


    $.getJSON('/background_process', {
				  redValues: JSON.stringify(redValues),
                  greenValues: JSON.stringify(greenValues),
				  blueValues: JSON.stringify(blueValues),

				}, function(data) {
        // returned from the server
        document.getElementById("result").style.display = "block";
        location.href = "#result";
				  console.log(data.result)
				});}


    //console.log(redValues)
    //console.log(greenValues)
    //console.log(blueValues)
}



function show(col){
    if(col == 'red'){
     color = 'red'
    document.getElementById('redButton').className = "btn btn-outline-danger active"
    document.getElementById('greenButton').className = "btn btn-outline-success"
    document.getElementById('blueButton').className = "btn btn-outline-primary"
        
    }
    else
    if(col == 'green'){
     color = 'green'
    document.getElementById('redButton').className = "btn btn-outline-danger"
    document.getElementById('greenButton').className = "btn btn-outline-success active"
    document.getElementById('blueButton').className = "btn btn-outline-primary"
    }
    else
    if(col == 'blue'){
     color = 'blue'
    document.getElementById('redButton').className = "btn btn-outline-danger"
    document.getElementById('greenButton').className = "btn btn-outline-success"
    document.getElementById('blueButton').className = "btn btn-outline-primary active"
    }
}








</script>

</body>

</html>
